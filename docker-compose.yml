services:
  app:
    build: ./
    volumes:
      - ./src:/usr/src/app/src
    ports:
      - "3000:3000"
    command: "npm run start:dev"
    environment:
      - PORT=${PORT}
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS}

  auth-db:
    image: postgres:16.2
    container_name: auth-db
    restart: always
    volumes:
      - ./postgres:/var/lib/postgresql/data
    environment:
      - POSTGRES_USER=${POSTGRES_USER}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - POSTGRES_DB=${POSTGRES_DB}
    ports:
      - "5432:5432"

  redis_auth:
    image: redis:alpine
    container_name: redis_auth
    restart: always
    ports:
      - "6379:6379"
    volumes:
      - ./redis_data:/data # Volumen para persistencia de datos
    environment:
      - REDIS_PASSWORD=${REDIS_PASSWORD} # Contrase√±a para Redis
    command: redis-server --appendonly yes # Activa el archivo de registro
